{"pageProps":{"post":{"attributes":{},"html":"<h2 id=\"authentication\">Authentication</h2>\n<p>We need to be able to make API request to API routes that will allow a user to sign in and register. Lets make those functions in <code>/lib/api</code></p>\n<pre><code class=\"hljs language-ts\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">fetcher</span> = <span class=\"hljs-keyword\">async</span> (<span class=\"hljs-params\">{ url, method, body, json = <span class=\"hljs-literal\">true</span> }</span>) =&gt; {\n  <span class=\"hljs-keyword\">const</span> res = <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title function_\">fetch</span>(url, {\n    method,\n    <span class=\"hljs-attr\">body</span>: body &amp;&amp; <span class=\"hljs-title class_\">JSON</span>.<span class=\"hljs-title function_\">stringify</span>(body),\n    <span class=\"hljs-attr\">headers</span>: {\n      <span class=\"hljs-title class_\">Accept</span>: <span class=\"hljs-string\">&quot;application/json&quot;</span>,\n      <span class=\"hljs-string\">&quot;Content-Type&quot;</span>: <span class=\"hljs-string\">&quot;application/json&quot;</span>,\n    },\n  });\n\n  <span class=\"hljs-keyword\">if</span> (!res.<span class=\"hljs-property\">ok</span>) {\n    <span class=\"hljs-keyword\">throw</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Error</span>(<span class=\"hljs-string\">&quot;API Error&quot;</span>);\n  }\n\n  <span class=\"hljs-keyword\">if</span> (json) {\n    <span class=\"hljs-keyword\">const</span> data = <span class=\"hljs-keyword\">await</span> res.<span class=\"hljs-title function_\">json</span>();\n    <span class=\"hljs-keyword\">return</span> data;\n  }\n};\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">register</span> = <span class=\"hljs-keyword\">async</span> (<span class=\"hljs-params\">user</span>) =&gt; {\n  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title function_\">fetcher</span>({\n    <span class=\"hljs-attr\">url</span>: <span class=\"hljs-string\">&quot;/api/register&quot;</span>,\n    <span class=\"hljs-attr\">method</span>: <span class=\"hljs-string\">&quot;POST&quot;</span>,\n    <span class=\"hljs-attr\">body</span>: user,\n    <span class=\"hljs-attr\">json</span>: <span class=\"hljs-literal\">false</span>,\n  });\n};\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">signin</span> = <span class=\"hljs-keyword\">async</span> (<span class=\"hljs-params\">user</span>) =&gt; {\n  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title function_\">fetcher</span>({\n    <span class=\"hljs-attr\">url</span>: <span class=\"hljs-string\">&quot;/api/signin&quot;</span>,\n    <span class=\"hljs-attr\">method</span>: <span class=\"hljs-string\">&quot;POST&quot;</span>,\n    <span class=\"hljs-attr\">body</span>: user,\n    <span class=\"hljs-attr\">json</span>: <span class=\"hljs-literal\">false</span>,\n  });\n};\n</code></pre>\n<h2 id=\"authform-component\">AuthForm component</h2>\n<pre><code class=\"hljs language-tsx\"><span class=\"hljs-string\">&quot;use client&quot;</span>;\n<span class=\"hljs-keyword\">import</span> { register, signin } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;@/lib/api&quot;</span>;\n<span class=\"hljs-keyword\">import</span> { useCallback, useState } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;react&quot;</span>;\n<span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">Link</span> <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;next/link&quot;</span>;\n<span class=\"hljs-keyword\">import</span> { useRouter } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;next/navigation&quot;</span>;\n<span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">Card</span> <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;./Card&quot;</span>;\n<span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">Button</span> <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;./Button&quot;</span>;\n<span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">Input</span> <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;./Input&quot;</span>;\n\n<span class=\"hljs-keyword\">const</span> registerContent = {\n  <span class=\"hljs-attr\">linkUrl</span>: <span class=\"hljs-string\">&quot;/signin&quot;</span>,\n  <span class=\"hljs-attr\">linkText</span>: <span class=\"hljs-string\">&quot;Already have an account?&quot;</span>,\n  <span class=\"hljs-attr\">header</span>: <span class=\"hljs-string\">&quot;Create a new Account&quot;</span>,\n  <span class=\"hljs-attr\">subheader</span>: <span class=\"hljs-string\">&quot;Just a few things to get started&quot;</span>,\n  <span class=\"hljs-attr\">buttonText</span>: <span class=\"hljs-string\">&quot;Register&quot;</span>,\n};\n\n<span class=\"hljs-keyword\">const</span> signinContent = {\n  <span class=\"hljs-attr\">linkUrl</span>: <span class=\"hljs-string\">&quot;/register&quot;</span>,\n  <span class=\"hljs-attr\">linkText</span>: <span class=\"hljs-string\">&quot;Don&#x27;t have an account?&quot;</span>,\n  <span class=\"hljs-attr\">header</span>: <span class=\"hljs-string\">&quot;Welcome Back&quot;</span>,\n  <span class=\"hljs-attr\">subheader</span>: <span class=\"hljs-string\">&quot;Enter your credentials to access your account&quot;</span>,\n  <span class=\"hljs-attr\">buttonText</span>: <span class=\"hljs-string\">&quot;Sign In&quot;</span>,\n};\n\n<span class=\"hljs-keyword\">const</span> initial = { <span class=\"hljs-attr\">email</span>: <span class=\"hljs-string\">&quot;&quot;</span>, <span class=\"hljs-attr\">password</span>: <span class=\"hljs-string\">&quot;&quot;</span>, <span class=\"hljs-attr\">firstName</span>: <span class=\"hljs-string\">&quot;&quot;</span>, <span class=\"hljs-attr\">lastName</span>: <span class=\"hljs-string\">&quot;&quot;</span> };\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">AuthForm</span>(<span class=\"hljs-params\">{ mode }: { mode: <span class=\"hljs-string\">&quot;register&quot;</span> | <span class=\"hljs-string\">&quot;signin&quot;</span> }</span>) {\n  <span class=\"hljs-keyword\">const</span> [formState, setFormState] = <span class=\"hljs-title function_\">useState</span>({ ...initial });\n  <span class=\"hljs-keyword\">const</span> [error, setError] = <span class=\"hljs-title function_\">useState</span>(<span class=\"hljs-string\">&quot;&quot;</span>);\n\n  <span class=\"hljs-keyword\">const</span> router = <span class=\"hljs-title function_\">useRouter</span>();\n  <span class=\"hljs-keyword\">const</span> handleSubmit = <span class=\"hljs-title function_\">useCallback</span>(\n    <span class=\"hljs-keyword\">async</span> (e) =&gt; {\n      e.<span class=\"hljs-title function_\">preventDefault</span>();\n\n      <span class=\"hljs-keyword\">try</span> {\n        <span class=\"hljs-keyword\">if</span> (mode === <span class=\"hljs-string\">&quot;register&quot;</span>) {\n          <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title function_\">register</span>(formState);\n        } <span class=\"hljs-keyword\">else</span> {\n          <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title function_\">signin</span>(formState);\n        }\n\n        router.<span class=\"hljs-title function_\">replace</span>(<span class=\"hljs-string\">&quot;/home&quot;</span>);\n      } <span class=\"hljs-keyword\">catch</span> (e) {\n        <span class=\"hljs-title function_\">setError</span>(<span class=\"hljs-string\">`Could not <span class=\"hljs-subst\">${mode}</span>`</span>);\n      } <span class=\"hljs-keyword\">finally</span> {\n        <span class=\"hljs-title function_\">setFormState</span>({ ...initial });\n      }\n    },\n    [\n      formState.<span class=\"hljs-property\">email</span>,\n      formState.<span class=\"hljs-property\">password</span>,\n      formState.<span class=\"hljs-property\">firstName</span>,\n      formState.<span class=\"hljs-property\">lastName</span>,\n    ]\n  );\n\n  <span class=\"hljs-keyword\">const</span> content = mode === <span class=\"hljs-string\">&quot;register&quot;</span> ? registerContent : signinContent;\n\n  <span class=\"hljs-keyword\">return</span> (\n    <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Card</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">className</span>=<span class=\"hljs-string\">&quot;w-full&quot;</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">className</span>=<span class=\"hljs-string\">&quot;text-center&quot;</span>&gt;</span>\n          <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h2</span> <span class=\"hljs-attr\">className</span>=<span class=\"hljs-string\">&quot;text-3xl mb-2&quot;</span>&gt;</span>{content.header}<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h2</span>&gt;</span>\n          <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">p</span> <span class=\"hljs-attr\">className</span>=<span class=\"hljs-string\">&quot;tex-lg text-black/25&quot;</span>&gt;</span>{content.subheader}<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">p</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">form</span> <span class=\"hljs-attr\">onSubmit</span>=<span class=\"hljs-string\">{handleSubmit}</span> <span class=\"hljs-attr\">className</span>=<span class=\"hljs-string\">&quot;py-10 w-full&quot;</span>&gt;</span>\n          {mode === &quot;register&quot; &amp;&amp; (\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">className</span>=<span class=\"hljs-string\">&quot;flex mb-8 justify-between&quot;</span>&gt;</span>\n              <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">className</span>=<span class=\"hljs-string\">&quot;pr-2&quot;</span>&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">className</span>=<span class=\"hljs-string\">&quot;text-lg mb-4 ml-2 text-black/50&quot;</span>&gt;</span>\n                  First Name\n                <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Input</span>\n                  <span class=\"hljs-attr\">required</span>\n                  <span class=\"hljs-attr\">placeholder</span>=<span class=\"hljs-string\">&quot;First Name&quot;</span>\n                  <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">{formState.firstName}</span>\n                  <span class=\"hljs-attr\">className</span>=<span class=\"hljs-string\">&quot;border-solid border-gray border-2 px-6 py-2 text-lg rounded-3xl w-full&quot;</span>\n                  <span class=\"hljs-attr\">onChange</span>=<span class=\"hljs-string\">{(e)</span> =&gt;</span>\n                    setFormState((s) =&gt; ({ ...s, firstName: e.target.value }))\n                  }\n                /&gt;\n              <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span>\n              <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">className</span>=<span class=\"hljs-string\">&quot;pl-2&quot;</span>&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">className</span>=<span class=\"hljs-string\">&quot;text-lg mb-4 ml-2 text-black/50&quot;</span>&gt;</span>Last Name<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Input</span>\n                  <span class=\"hljs-attr\">required</span>\n                  <span class=\"hljs-attr\">placeholder</span>=<span class=\"hljs-string\">&quot;Last Name&quot;</span>\n                  <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">{formState.lastName}</span>\n                  <span class=\"hljs-attr\">className</span>=<span class=\"hljs-string\">&quot;border-solid border-gray border-2 px-6 py-2 text-lg rounded-3xl w-full&quot;</span>\n                  <span class=\"hljs-attr\">onChange</span>=<span class=\"hljs-string\">{(e)</span> =&gt;</span>\n                    setFormState((s) =&gt; ({ ...s, lastName: e.target.value }))\n                  }\n                /&gt;\n              <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span>\n          )}\n          <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">className</span>=<span class=\"hljs-string\">&quot;mb-8&quot;</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">className</span>=<span class=\"hljs-string\">&quot;text-lg mb-4 ml-2 text-black/50&quot;</span>&gt;</span>Email<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Input</span>\n              <span class=\"hljs-attr\">required</span>\n              <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;email&quot;</span>\n              <span class=\"hljs-attr\">placeholder</span>=<span class=\"hljs-string\">&quot;Email&quot;</span>\n              <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">{formState.email}</span>\n              <span class=\"hljs-attr\">className</span>=<span class=\"hljs-string\">&quot;border-solid border-gray border-2 px-6 py-2 text-lg rounded-3xl w-full&quot;</span>\n              <span class=\"hljs-attr\">onChange</span>=<span class=\"hljs-string\">{(e)</span> =&gt;</span>\n                setFormState((s) =&gt; ({ ...s, email: e.target.value }))\n              }\n            /&gt;\n          <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span>\n          <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">className</span>=<span class=\"hljs-string\">&quot;mb-8&quot;</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">className</span>=<span class=\"hljs-string\">&quot;text-lg mb-4 ml-2 text-black/50&quot;</span>&gt;</span>Password<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Input</span>\n              <span class=\"hljs-attr\">required</span>\n              <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">{formState.password}</span>\n              <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;password&quot;</span>\n              <span class=\"hljs-attr\">placeholder</span>=<span class=\"hljs-string\">&quot;Password&quot;</span>\n              <span class=\"hljs-attr\">className</span>=<span class=\"hljs-string\">&quot;border-solid border-gray border-2 px-6 py-2 text-lg rounded-3xl w-full&quot;</span>\n              <span class=\"hljs-attr\">onChange</span>=<span class=\"hljs-string\">{(e)</span> =&gt;</span>\n                setFormState((s) =&gt; ({ ...s, password: e.target.value }))\n              }\n            /&gt;\n          <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span>\n          <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">className</span>=<span class=\"hljs-string\">&quot;flex items-center justify-between&quot;</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span>&gt;</span>\n              <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">span</span>&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Link</span>\n                  <span class=\"hljs-attr\">href</span>=<span class=\"hljs-string\">{content.linkUrl}</span>\n                  <span class=\"hljs-attr\">className</span>=<span class=\"hljs-string\">&quot;text-blue-600 font-bold&quot;</span>\n                &gt;</span>\n                  {content.linkText}\n                <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">Link</span>&gt;</span>\n              <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">span</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span>&gt;</span>\n              <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Button</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;submit&quot;</span> <span class=\"hljs-attr\">intent</span>=<span class=\"hljs-string\">&quot;secondary&quot;</span>&gt;</span>\n                {content.buttonText}\n              <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">Button</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span>\n          <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">form</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">Card</span>&gt;</span></span>\n  );\n}\n</code></pre>\n","slug":"authform","title":"Authform","section":"Auth","icon":"lock","filePath":"/home/runner/work/fullstack-v2-instructions/fullstack-v2-instructions/lessons/07-auth/A-authform.md","nextSlug":"/lessons/auth/pages","prevSlug":"/lessons/ui-components/sidebar-link"}},"__N_SSG":true}