{"pageProps":{"post":{"attributes":{},"html":"<h2 id=\"db-helper-functions\">DB Helper Functions</h2>\n<p>Because Next API functions run in a serveless environment, we&#39;re going to cache our Prisma client and reuse it when possible to avoid having too many connections.</p>\n<p>In <code>/lib/db.ts</code> add this</p>\n<pre><code class=\"hljs language-ts\"><span class=\"hljs-keyword\">import</span> { <span class=\"hljs-title class_\">PrismaClient</span> } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;@prisma/client&quot;</span>;\n\n<span class=\"hljs-keyword\">declare</span> <span class=\"hljs-variable language_\">global</span> {\n  <span class=\"hljs-comment\">// eslint-disable-next-line no-var</span>\n  <span class=\"hljs-keyword\">var</span> <span class=\"hljs-attr\">cachedPrisma</span>: <span class=\"hljs-title class_\">PrismaClient</span>;\n}\n\n<span class=\"hljs-keyword\">let</span> <span class=\"hljs-attr\">prisma</span>: <span class=\"hljs-title class_\">PrismaClient</span>;\n<span class=\"hljs-keyword\">if</span> (process.<span class=\"hljs-property\">env</span>.<span class=\"hljs-property\">NODE_ENV</span> === <span class=\"hljs-string\">&quot;production&quot;</span>) {\n  prisma = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">PrismaClient</span>();\n} <span class=\"hljs-keyword\">else</span> {\n  <span class=\"hljs-keyword\">if</span> (!<span class=\"hljs-variable language_\">global</span>.<span class=\"hljs-property\">cachedPrisma</span>) {\n    <span class=\"hljs-variable language_\">global</span>.<span class=\"hljs-property\">cachedPrisma</span> = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">PrismaClient</span>();\n  }\n  prisma = <span class=\"hljs-variable language_\">global</span>.<span class=\"hljs-property\">cachedPrisma</span>;\n}\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> db = prisma;\n</code></pre>\n","slug":"helper","title":"Helper","section":"Db","icon":"database","filePath":"/home/runner/work/fullstack-v2-instructions/fullstack-v2-instructions/lessons/03-db/D-helper.md","nextSlug":"/lessons/db/seed-script","prevSlug":"/lessons/db/migrations"}},"__N_SSG":true}